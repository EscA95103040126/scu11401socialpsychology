# -*- coding: utf-8 -*-
"""app.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1l-58DapU8CQJrp78O70Bny6Hk8zVl_Qj
"""

import streamlit as st
import pandas as pd
import random

# --- è¨­å®šç¶²é  ---
st.title("ğŸ§© ç¤¾æœƒå¿ƒç†å­¸ï¼šè‡ªå‹•é¡Œåº«ç·´ç¿’")
st.write("é¡Œç›®æœƒè‡ªå‹•å¾é¡Œåº«ä¸­éš¨æ©ŸæŠ½å‡ºï¼Œä¸¦è‡ªå‹•ç”ŸæˆéŒ¯èª¤é¸é …ï¼")

# --- 1. è®€å–è³‡æ–™ ---
# åŠ ä¸Š @st.cache_data è®“è³‡æ–™è®€å–ä¸€æ¬¡å°±å¥½ï¼Œç¶²é è·‘æ¯”è¼ƒå¿«
@st.cache_data
def load_data():
    # é€™è£¡çš„æª”åå¿…é ˆè·Ÿä½ ä¸Šå‚³åˆ° GitHub çš„ csv æª”åä¸€æ¨¡ä¸€æ¨£
    # é è¨­ Pandas æœƒæŠŠ CSV è®€æˆ DataFrame
    df = pd.read_csv("scusocpsy.csv")
    return df

try:
    df = load_data()
except Exception as e:
    st.error(f"æ‰¾ä¸åˆ° data.csv æª”æ¡ˆï¼Œè«‹ç¢ºå®šä½ æœ‰ä¸Šå‚³ CSV åˆ° GitHubï¼éŒ¯èª¤è¨Šæ¯ï¼š{e}")
    st.stop()

# ç¢ºä¿è³‡æ–™é‡è¶³å¤  (è‡³å°‘è¦æœ‰ 4 å€‹åè©æ‰èƒ½æ¹Šå‡º 1 å€‹æ­£è§£ + 3 å€‹èª˜ç­”)
if len(df) < 4:
    st.warning("é¡Œåº«è£¡çš„è³‡æ–™å¤ªå°‘äº†ï¼è«‹è‡³å°‘æº–å‚™ 4 å€‹åè©è§£é‡‹ã€‚")
    st.stop()

# --- 2. åˆå§‹åŒ– Session State (ç”¨ä¾†è¨˜ä½ç¾åœ¨é¡Œç›®æ˜¯ä»€éº¼) ---
# Streamlit æ¯æ¬¡æŒ‰æŒ‰éˆ•éƒ½æœƒé‡è·‘ï¼Œæ‰€ä»¥è¦ç”¨ Session State è¨˜ä½ç¾åœ¨æ˜¯å“ªä¸€é¡Œï¼Œä¸ç„¶é¡Œç›®æœƒä¸€ç›´äº‚è·³
if 'current_question' not in st.session_state:
    st.session_state.current_question = None
if 'options' not in st.session_state:
    st.session_state.options = []
if 'correct_answer' not in st.session_state:
    st.session_state.correct_answer = None

# --- 3. å‡ºé¡Œé‚è¼¯å‡½æ•¸ ---
def generate_question():
    # éš¨æ©Ÿé¸ä¸€å€‹åè©ç•¶é¡Œç›® (row æ˜¯ä¸€æ•´åˆ—è³‡æ–™)
    question_row = df.sample(1).iloc[0]
    correct_term = question_row['term']      # æ­£ç¢ºåè©
    question_text = question_row['definition'] # é¡Œç›®(è§£é‡‹)

    # å¾å‰©ä¸‹çš„è³‡æ–™ä¸­ï¼Œéš¨æ©Ÿé¸ 3 å€‹éŒ¯èª¤çš„åè©
    # df[df['term'] != correct_term] æ„æ€æ˜¯ã€Œéæ¿¾æ‰æ­£ç¢ºç­”æ¡ˆçš„é‚£ä¸€è¡Œã€
    wrong_options = df[df['term'] != correct_term]['term'].sample(3).tolist()

    # çµ„åˆé¸é …ï¼š1å€‹æ­£è§£ + 3å€‹éŒ¯çš„
    all_options = wrong_options + [correct_term]
    random.shuffle(all_options) # æŠŠé¸é …é †åºæ‰“äº‚

    # å­˜å…¥ Session State
    st.session_state.current_question = question_text
    st.session_state.correct_answer = correct_term
    st.session_state.options = all_options
    # æ¸…é™¤ä¹‹å‰çš„é¸æ“‡èˆ‡çµæœ
    st.session_state.user_submitted = False

# å¦‚æœå‰›é€²ä¾†ç¶²é é‚„æ²’é¡Œç›®ï¼Œå°±å‡ºä¸€é¡Œ
if st.session_state.current_question is None:
    generate_question()

# --- 4. é¡¯ç¤ºé¡Œç›®å€åŸŸ ---
st.markdown("### é¡Œç›®ï¼š")
st.info(st.session_state.current_question)

# é¡¯ç¤ºé¸é … Radio Button
user_choice = st.radio("è«‹é¸æ“‡æ­£ç¢ºçš„åè©ï¼š", st.session_state.options)

# --- 5. é€å‡ºèˆ‡çµæœ ---
if st.button("é€å‡ºç­”æ¡ˆ"):
    st.session_state.user_submitted = True

if st.session_state.get('user_submitted'):
    if user_choice == st.session_state.correct_answer:
        st.balloons()
        st.success(f"âœ… ç­”å°äº†ï¼ç­”æ¡ˆå°±æ˜¯ **{st.session_state.correct_answer}**")
    else:
        st.error(f"âŒ ç­”éŒ¯å›‰ï¼æ­£ç¢ºç­”æ¡ˆæ˜¯ï¼š**{st.session_state.correct_answer}**")

    st.markdown("---")
    # ä¸‹ä¸€é¡ŒæŒ‰éˆ•
    if st.button("ä¸‹ä¸€é¡Œ â¡ï¸"):
        generate_question() # é‡æ–°æŠ½é¡Œ
        st.rerun() # é‡æ–°æ•´ç†é é¢